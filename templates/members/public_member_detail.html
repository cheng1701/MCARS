{% extends 'base.html' %}
{% load member_extras %}
{% block title %}{{ title|default:'Member Profile' }}{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container">
    <nav aria-label="breadcrumb" class="mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'members:home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'members:public_member_list' %}">Member Directory</a></li>
        <li class="breadcrumb-item active">Profile</li>
      </ol>
    </nav>

    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="me-3">
                {% if member.profile_image %}
                <img src="{{ member.profile_image.url }}" alt="{{ member.user.get_full_name }}" class="rounded-circle" style="width:80px;height:80px;object-fit:cover;">
                {% else %}
                <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" style="width:80px;height:80px;">
                  <span class="text-white fw-bold fs-4">{{ member.user.first_name|first }}{{ member.user.last_name|first }}</span>
                </div>
                {% endif %}
              </div>
              <div>
                <h2 class="mb-1">{{ member.get_ranked_name|default:member.user.get_full_name }}</h2>
                {% if member.user.email %}
                <div><a href="mailto:{{ member.user.email }}">{{ member.user.email }}</a></div>
                {% endif %}
                {% if member.city or member.state %}
                <div class="text-muted small">{{ member.city }}{% if member.state %}, {{ member.state }}{% endif %}</div>
                {% endif %}
                <div class="text-muted small">Member since {{ member.created_at|date:'F j, Y' }}</div>
              </div>
            </div>

            {% if member.rank_association %}
            <div class="card mb-3">
              <div class="card-header">
                <strong>Current Rank</strong>
              </div>
              <div class="card-body d-flex align-items-center">
                {% with img=member|get_rank_image %}
                {% if img %}
                <img src="{{ img }}" alt="{{ member.rank_association.rank.short_name }}" class="me-3" style="width:60px;height:auto;">
                {% endif %}
                {% endwith %}
                <div>
                  <div class="fw-semibold">{{ member.rank_association.rank.short_name }}</div>
                  <div class="text-muted small">{{ member.rank_association.rank.paygrade }} Â· {{ member.rank_association.rank.long_name }}</div>
                </div>
              </div>
            </div>
            {% endif %}

            <div class="card">
              <div class="card-header">
                <strong>Active Units</strong>
              </div>
              <div class="card-body">
                {% if active_memberships %}
                  <ul class="list-group list-group-flush">
                    {% for mem in active_memberships %}
                    <li class="list-group-item d-flex align-items-center">
                      {% if mem.unit.image %}
                      <a href="{% url 'units:unit_public' mem.unit.id %}">
                        <img src="{{ mem.unit.image.url }}" class="rounded me-2" style="width:40px;height:40px;object-fit:cover;" alt="{{ mem.unit.get_display_name }}">
                      </a>
                      {% endif %}
                      <div>
                        <div class="fw-semibold"><a class="text-decoration-none" href="{% url 'units:unit_public' mem.unit.id %}">{{ mem.unit.get_display_name }}</a></div>
                        <div class="text-muted small">{{ mem.unit.get_type_display }}</div>
                      </div>
                    </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <div class="text-muted">No active unit memberships.</div>
                {% endif %}
              </div>
            </div>

            <div class="mt-3 d-flex justify-content-between">
              <a class="btn btn-outline-secondary" href="{% url 'members:public_member_list' %}"><i class="fas fa-arrow-left me-1"></i> Back to Directory</a>
              <a class="btn btn-outline-primary" href="{% url 'units:unit_org_chart' %}"><i class="fas fa-sitemap me-1"></i> Org Chart</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
