{% extends 'base.html' %}

{% block title %}My Settings{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container">
    <nav aria-label="breadcrumb" class="mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'members:home' %}">Home</a></li>
        <li class="breadcrumb-item active">My Settings</li>
      </ol>
    </nav>

    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Personal Settings</h4>
          </div>
          <div class="card-body">
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
              {% endfor %}
            {% endif %}

            <form method="post" class="needs-validation" novalidate>
              {% csrf_token %}

              <div class="mb-4">
                <h6 class="text-uppercase text-muted">Appearance</h6>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="id_site_theme" class="form-label">Site Theme</label>
                    {{ form.site_theme }}
                    <div class="form-text">Choose Light or Dark mode for the whole website.</div>
                    {% if form.site_theme.errors %}
                    <div class="invalid-feedback d-block">
                      {% for error in form.site_theme.errors %}{{ error }}{% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <hr>

              <div class="mb-3">
                <h6 class="text-uppercase text-muted">Rank Theme</h6>
                {% if has_rank %}
                  <div class="mb-2 small text-muted">Current Rank: <span class="badge bg-secondary">{{ rank_info.paygrade }}</span> {{ rank_info.short_name }} &middot; {{ rank_info.long_name }}</div>
                  <div class="row g-3">
                    <div class="col-md-8">
                      <label for="id_preferred_theme" class="form-label">Preferred Rank Theme</label>
                      {% if form.preferred_theme %}
                        {{ form.preferred_theme }}
                        <div class="form-text">Only themes compatible with your current rank are available. Leave blank to use the system default.</div>
                        {% if form.preferred_theme.errors %}
                        <div class="invalid-feedback d-block">
                          {% for error in form.preferred_theme.errors %}{{ error }}{% endfor %}
                        </div>
                        {% endif %}
                      {% else %}
                        <div class="alert alert-info mb-0">No rank themes are available for your current rank. The system default will be used.</div>
                      {% endif %}
                    </div>
                  </div>
                {% else %}
                  <div class="alert alert-info mb-0">You don't have a rank assigned yet. Once you have a rank, you'll be able to choose a preferred theme for your insignia.</div>
                {% endif %}
              </div>

              <div class="d-flex justify-content-end">
                <a href="{% url 'members:member_dashboard' %}" class="btn btn-outline-secondary me-2"><i class="fas fa-arrow-left me-1"></i> Back to Dashboard</a>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i> Save Settings</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
// Bootstrap-style validation feedback before submission
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    Array.prototype.forEach.call(forms, function(form) {
      form.querySelectorAll('input, select, textarea').forEach(function(el) {
        ['input','change','blur'].forEach(function(evt) {
          el.addEventListener(evt, function() {
            form.classList.add('was-validated');
          });
        });
      });
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();
</script>
{% endblock %}
